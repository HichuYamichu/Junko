version: '3.4'

x-defaults: &defaults
  restart: unless-stopped
  networks:
    - main
  logging:
    driver: loki
    options:
      loki-url: "http://localhost:3100/api/prom/push"
  
services:
  bot:
    <<: *defaults
    build: ./src/bot
    env_file:
      - ./env/bot/.env
    volumes:
      - ./src/proto:/usr/src/proto
    
  api:
    <<: *defaults
    build: ./src/api
    env_file:
      - ./env/api/.env
    
  dashboard:
    <<: *defaults
    build: ./src/dashboard
    env_file:
      - ./env/dashboard/.env

networks:
  main:
    external: true
